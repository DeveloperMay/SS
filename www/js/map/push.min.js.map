{"version":3,"names":[],"mappings":"","sources":["push.js"],"sourcesContent":["var jsdominio = 'https://abigor.com.br',\n\tlockExitMessage = '',\n\tXHRPopState = '',\n\tXHRPopLastController = '/',\n\tXHRPopStateScroll = {},\n\tlockChangePageFn = false,\n\tlockChangePage = false,\n\tlockClosePage = false,\n\tXHRPopStateShowStatus = true;\n\nwindow.push = {\n\tcontrolador: '/',\n\taction: '',\n\trespostaAjax: '',\n\trender: a.id('content'),\n\tpushLoader: a.id('push-loader'),\n\tmobile: '/mobile',\n\thistory: {\n\t\tinit: function(configObj){\n\n\t\t\tvar xhrfn = function(){};\n\t\t\tvar lockChangePageFn = function(){};\n\t\t\tvar lockExitMessage = '';\n\n\t\t\tif(typeof(configObj.xhrfn) === 'function'){\n\t\t\t\txhrfn = configObj.xhrfn;\n\t\t\t}\n\n\t\t\tif(typeof(configObj.lockChangePageFn) === 'function'){\n\t\t\t\tlockChangePageFn = configObj.lockChangePageFn;\n\t\t\t}\n\n\t\t\tif(configObj.lockExitMessage){\n\t\t\t\tlockExitMessage = configObj.lockExitMessage;\n\t\t\t}\n\n\t\t\t/* POPSTATE EVENT */\n\t\t\ta.evts.add('popstate', window, function(evts){\n\n\t\t\t\tif(lockChangePage === true){\n\t\t\t\t\tlockChangePageFn(window.location.href);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar host = window.location.protocol+'//'+window.location.host;\n\t\t\t\tvar controler = window.location.href.replace(host, '')+'!popstate';\n\t\t\t\txhrfn(controler, function(){});\n\n\t\t\t});\n\n\t\t\t/* CLICK EVENTS */\n\t\t\ta.evts.add('click', document, function(evts){\n\t\t\t\t\n\t\t\t\tvar elemt = evts.target;\n\n\t\t\t\tvar expJs = new RegExp('javascript:', 'i');\n\t\t\t\tvar expFTP = new RegExp('ftp:', 'i');\n\t\t\t\tvar expMail = new RegExp('mailto:', 'i');\n\t\t\t\tvar expWhatsapp = new RegExp('whatsapp:', 'i');\n\n\t\t\t\tvar domain = window.location.hostname;\n\n\t\t\t\tif(elemt.parentElement !== null && elemt.nodeName !== 'BUTTON' && elemt.parentElement.nodeName === 'BUTTON'){\n\t\t\t\t\telemt = elemt.parentElement;\n\t\t\t\t}\n\n\t\t\t\tif(elemt.nodeName === 'BUTTON' && elemt.getAttribute('data-href') && elemt.getAttribute('data-href') !== false){\n\n\t\t\t\t\tvar hrefDomain = elemt.getAttribute('data-href').replace('http://', '');\n\t\t\t\t\threfDomain = hrefDomain.replace('https://', '');\n\n\t\t\t\t\tvar re = new RegExp('^\\/', 'i'); \n\n\t\t\t\t\tif(re.test(hrefDomain) === true){\n\t\t\t\t\t\threfDomain = domain+hrefDomain;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar urlIn = new RegExp('^'+domain, 'i');\n\n\t\t\t\t\tif(urlIn.test(hrefDomain) === true){\n\t\t\t\t\t\ta.pushstate.goXHR(elemt.getAttribute('data-href'), xhrfn, lockChangePageFn);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tvar a = document.createElement('a');\n\t\t\t\t\t\ta.href = elemt.getAttribute('data-href');\n\t\t\t\t\t\ta.trigger('click', a);\n\t\t\t\t\t}\n\t\t\t\t}else{\n\n\t\t\t\t\tvar wl = true;\n\t\t\t\t\twhile(wl === true){\n\n\t\t\t\t\t\tif(elemt.parentNode !== null && elemt.nodeName !== 'A'){\n\t\t\t\t\t\t\telemt = elemt.parentNode;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\twl = false;\n\n\t\t\t\t\t\t\tif(elemt.href){\n\n\t\t\t\t\t\t\t\tvar hrefDomain = elemt.href.replace('http://', '');\n\t\t\t\t\t\t\t\threfDomain = hrefDomain.replace('https://', '');\n\n\t\t\t\t\t\t\t\tvar urlIn = new RegExp('^'+domain, 'i');\n\n\t\t\t\t\t\t\t\tif(urlIn.test(hrefDomain) === true && !elemt.getAttribute('data-href')){\n\n\t\t\t\t\t\t\t\t\t/* GOXHR*/\n\t\t\t\t\t\t\t\t\tif(expJs.test(elemt.href) === false || \n\t\t\t\t\t\t\t\t\t\texpFTP.test(elemt.href) === false || \n\t\t\t\t\t\t\t\t\t\texpMail.test(elemt.href) === false || \n\t\t\t\t\t\t\t\t\t\texpWhatsapp.test(elemt.href) === false || \n\t\t\t\t\t\t\t\t\t\t!elemt.getAttribute('data-href')){\n\n\t\t\t\t\t\t\t\t\t\tif(evts.stopPropagation){\n\t\t\t\t\t\t\t\t\t\t\tevts.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif(evts.preventDefault){\n\t\t\t\t\t\t\t\t\t\t\tevts.preventDefault();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tpush.history.goXHR(elemt.href, xhrfn, lockChangePageFn);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* beforeunload EVENT  */\n\t\t\ta.evts.add('beforeunload', window, function(evts){\n\t\t\t\tif(lockClosePage === true){\n\n\t\t\t\t\tevts.cancelBubble = true;\n\n\t\t\t\t\tevts.returnValue = lockExitMessage;\n\n\t\t\t\t\tif(evts.stopPropagation){\n\t\t\t\t\t\tevts.stopPropagation();\n\t\t\t\t\t}\n\n\t\t\t\t\tif(evts.preventDefault){\n\t\t\t\t\t\tevts.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn lockExitMessage;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tgoXHR: function(controler, xhrfn, lockChangePageFn){\n\n\t\t\tif(lockChangePage === true && lockChangePageFn){\n\t\t\t\tlockChangePageFn(controler);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar host = window.location.protocol+'//'+window.location.host;\n\t\t\tvar ctrlpage = window.location.href.replace(host, '');\n\t\t\tctrlpage = ctrlpage.replace(/\\?.*$/, '');\n\t\t\tXHRPopStateScroll[ctrlpage] = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;\n\n\t\t\txhrfn(controler, function(){\n\t\t\t\thistory.pushState({}, '', controler);\n\t\t\t});\n\n\t\t}\n\t},\n\turl: function(){\n\n\t\t/* PEGA O PATHNAME DA URL - TUDO DEPOIS DO PRIMEIRO /, exp /contato */\n\t\tlet url = window.location.pathname;\n\n\t\t/* IGNORA A VERSÃO MOBILE, EXP: /mobile/contato */\n\t\turl = url.replace(push.mobile, '');\n\n\t\t/* QUEBRA A URL */\n\t\turl = url.split('/');\n\n\t\t/* ATUALIZA A VARIAVEL CONTROLADOR */\n\t\tif(url[1]){\n\t\t\tpush.controlador = url[1];\n\t\t}\n\t\t\n\t\t/* ATUALIZA A VARIAVEL ACTION */\n\t\tif(url[2]){\n\t\t\tpush.action = url[2];\n\t\t}\n\t},\n\tgetAction: function(){\n\n\t\t/* ATUALIZA A ACTION */\n\t\tpush.url();\n\n\t\treturn push.action;\n\t},\n\tgetControlador: function(){\n\n\t\t/* ATUALIZA A CONTROLADOR */\n\t\tpush.url();\n\n\t\treturn push.controlador;\n\t},\n\tgetXHRPopStateShowStatus: function(){\n\t\treturn XHRPopStateShowStatus;\n\t},\n\tsetXHRPopStateShowStatus: function(st){\n\t\tXHRPopStateShowStatus = st;\n\t},\n\tseo: function(res){\n\n\t\t/* ATUALIZA O SEO DA PÁGINA PELAS INFORMAÇÕES DA VIEW - CONTROLADOR */\n\t\tif(typeof(res) !== 'undefined'){\n\n\t\t\tif(res.title){\n\t\t\t\tdocument.title = res.title;\n\t\t\t}\n\t\t\tif(res.description){\n\t\t\t\tdocument.querySelector('meta[name=\"description\"]').setAttribute(\"content\", res.description);\n\t\t\t}\n\t\t}\n\t},\n\tcheckJson: function(text){\n\t\tif (typeof text !==\"string\"){\n\t\t\treturn false;\n\t\t}\n\t\ttry{\n\t\t\treturn true;\n\t\t}\n\t\tcatch (error){\n\t\t\treturn false;\n\t\t}\n\t},\n\txhrfn: function(controler, doneCallFn){\n\n\t\tvar expPopstate = /!popstate+$/g;\n\t\tvar expHash = /#[.*\\S]+$/g;\n\t\tvar expHashExtract = /#([.*\\S]+)$/i;\n\t\tvar atualLocation = XHRPopLastController.replace(expHash, '');\n\n\t\tcontroler = controler.replace(expPopstate, '');\n\t\tvar testHash = controler;\n\n\t\t/* SCROLL TO HASH ELEMENT */\n\t\tif(expHashExtract.test(controler) === true){\n\t\t\tvar idByHash = controler.match(expHashExtract)[1];\n\t\t\tif(a.id(idByHash)){\n\t\t\t\tvar idByHashTop = a.positionAtTop(a.id(idByHash));\n\t\t\t\twindow.scrollTo(0, idByHashTop);\n\t\t\t}else{\n\t\t\t\twindow.scrollTo(0, XHRPopStateScroll[controler]);\n\t\t\t}\n\t\t}\n\n\t\tpush.pushLoader.style.width = '10%';\n\t\tpush.pushLoader.style.opacity = 1;\n\n\t\tif(XHRPopState){\n\t\t\tif(typeof(XHRPopState.abort) === 'function'){\n\t\t\t\tif(push.getXHRPopStateShowStatus() === false){\n\t\t\t\t\tconsole.warn('Cancelando request anterior.');\n\t\t\t\t}\n\t\t\t\tpush.setXHRPopStateShowStatus(false);\n\t\t\t\tXHRPopState.abort();\n\t\t\t}\n\t\t}\n\t\t\n\t\tpush.setXHRPopStateShowStatus(false);\n\n\t\tXHRPopState = a.ajax({\n\t\t\t'url': controler,\n\t\t\t'data': {'push': 'push'},\n\t\t\t'dataType': 'json',\n\t\t\t'done': function(rtn){\n\n\t\t\t\t/* ATUALIZA A VARIAVEL RESPOSTAAJAX */\n\t\t\t\tpush.respostaAjax = rtn;\n\n\t\t\t\tpush.setXHRPopStateShowStatus(true);\n\n\t\t\t\tdoneCallFn();\n\n\t\t\t\tpush.pushLoader.style.width = '50%';\n\n\t\t\t\t/* ATUALIZA O SEO DA PAGINA */\n\t\t\t\tpush.seo(rtn.metas);\n\n\t\t\t\tpush.render.innerHTML = '';\n\t\t\t\tpush.render.innerHTML = rtn.html;\n\n\t\t\t\ta.delay(function(){\n\n\t\t\t\t\t/* SCROLL TO HASH ELEMENT */\n\t\t\t\t\tif(expHashExtract.test(testHash) === true){\n\t\t\t\t\t\tvar idByHash = testHash.match(expHashExtract)[1];\n\t\t\t\t\t\tif(a.id(idByHash)){\n\t\t\t\t\t\t\tvar idByHashTop = a.positionAtTop(a.id(idByHash));\n\t\t\t\t\t\t\twindow.scrollTo(0, idByHashTop);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\twindow.scrollTo(0, XHRPopStateScroll[testHash]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\n\t\t\t\t\t\tcontrolerscroll = controler.replace(/\\?.*$/, '');\n\n\t\t\t\t\t\tif(XHRPopStateScroll[controlerscroll]){\n\t\t\t\t\t\t\twindow.scrollTo(0, XHRPopStateScroll[controlerscroll]);\n\t\t\t\t\t\t}else if(XHRPopStateScroll['/'+controlerscroll]){\n\t\t\t\t\t\t\twindow.scrollTo(0, XHRPopStateScroll['/'+controlerscroll]);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/* ESTE TRECHO É IMPORTANTISSIMO PARA EXECUTAR O JS DAS VIEWS, SEM ISSO NÃO EXECUTA JS DAS VIEWS! */\n\t\t\t\t\tvar scripts = push.render.getElementsByTagName('script');\n\t\t\t\t\tfor(x in scripts){\n\t\t\t\t\t\teval(scripts[x].innerHTML);\n\t\t\t\t\t}\n\n\t\t\t\t}, 30);\n\n\t\t\t\t/* CONTROLADOR INDEX */\n\t\t\t\tif(push.controlador == \"/\"){\n\n\t\t\t\t\tpush.pushLoader.style.width = '100%';\n\n\t\t\t\t\ta.delay(function(){\n\t\t\t\t\t\tpush.pushLoader.style.opacity = 0;\n\t\t\t\t\t}, 500);\n\n\t\t\t\t/* OUTROS */\n\t\t\t\t}else{\n\n\t\t\t\t\ta.delay(function(){\n\n\t\t\t\t\t\tpush.pushLoader.style.width = '100%';\n\n\t\t\t\t\t\ta.delay(function(){\n\t\t\t\t\t\t\tpush.pushLoader.style.opacity = 0;\n\t\t\t\t\t\t}, 500);\n\n\t\t\t\t\t\ta.delay(function(){\n\t\t\t\t\t\t\tpush.pushLoader.style.width = '0%';\n\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t}, 30);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'error': function(evts){\n\t\t\t\tif(push.getXHRPopStateShowStatus() === true){\n\t\t\t\t\ta.warning({'message': 'Não foi possível acessar o conteúdo requisitado, há algum problema com a Internet!'});\n\t\t\t\t\ta.delay(function(){\n\t\t\t\t\t\tpush.pushLoader.style.opacity = 0;\n\t\t\t\t\t}, 500);\n\n\t\t\t\t\ta.delay(function(){\n\t\t\t\t\t\tpush.pushLoader.style.width = '0%';\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\npush.history.init({\n\t'lockExitMessage': lockExitMessage,\n\t'xhrfn': push.xhrfn,\n\t'lockChangePageFn': lockChangePageFn\n});"],"file":"../push.min.js"}